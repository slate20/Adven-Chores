<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Adven-Chores</title>
        <link rel="stylesheet" href="/static/styles.css">
        <link href="https://fonts.googleapis.com/css2?family=Bubblegum+Sans&family=Fredoka:wght@300..700&display=swap" rel="stylesheet">
        <script src="https://unpkg.com/htmx.org@2.0.1"></script>
        <!-- <script>htmx.logAll();</script> -->
    </head>
    <body>
        <div class="app-container">
            <nav class="side-nav">
                <button class="nav-toggle" aria-label="Toggle navigation">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <img class="logo" src="/static/logo.png" alt="Adven-Chores Logo">
                <div id="child-nav" hx-get="/child-nav" hx-trigger="load, refreshList from:body">
                    <!-- This will be populated dynamically -->
                </div>
                <a class="nav-item" id="parent-panel" hx-prompt="Enter Pin" href="#" hx-get="/parent-panel" hx-target="#content" hx-swap="innerHTML">Parent Panel</a>
                <a class="nav-item" id="account-settings" hx-prompt="Enter Pin" href="#" hx-get="/account" hx-target="#content" hx-swap="innerHTML">Account</a>
                <a class="nav-item" id="logout-button" href="/logout">Logout</a>
            </nav>
            <main id="content">
                {{if .HasChildren}}
                    <div hx-get="/child-dashboard/{{.FirstChildID}}" hx-trigger="load" hx-swap="innerHTML"></div>
                {{else}}
                    <h2 text-align="center">Welcome to Adven-Chores!</h2>
                    <h3 id="landing-text" text-align="center" >Sign in to the parent panel to begin. The default PIN is 1234 and can be changed by clicking the "Change Pin" button</h3>
                {{end}}
            </main>
        </div>

        <script>
            document.body.addEventListener('htmx:afterSettle', function(event) {
                if (event.detail.target.id === 'child-list') {
                    // Select the first child by default
                    const firstChild = document.querySelector('#child-list li:first-child a');
                    if (firstChild) {
                        firstChild.click();
                    }
                }
            });
        </script>
        <script>
            const navToggle = document.querySelector('.nav-toggle');
            const nav = document.querySelector('.side-nav');
            
            navToggle.addEventListener('click', () => {
                nav.classList.toggle('collapsed');
            });
        </script>
        <script>
            document.body.addEventListener('htmx:afterSwap', function(event) {
                if (event.detail.target.id === 'content') {
                    history.pushState(null, '', '/');
                }
            });
        </script>
    </body>
</html>